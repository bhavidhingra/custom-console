#!/usr/bin/env bash

# shellcheck disable=SC2001
# shellcheck disable=SC2088
# shellcheck disable=SC2162

function chd() {

    if [[ $# -gt 0 ]]; then
        cd "$*" || { echo "[Error] couldn't enter $*"; }
        return
    fi

    while true; do
        printf "$(tput bold)%s" "$PWD$(tput sgr0)"

        dirContent=$(ls -t)
        itemList=(
            '..'
            '<-->'
            "${dirContent[@]}"
            '-'
            '~/'
            'ADD ALIAS'
            'SHOW ALIASES'
        )

        item="$(printf "%s\n" "${itemList[@]}" | fzf --color 'fg:27')"
        [[ -z "${item}" ]] && break

        [[ "${item}" == "-" ]] && {
            cd - &> /dev/null || { echo "[ERROR] couldn't go back to the previous directory"; }
            continue
        }

        [[ "${item}" == "<-->" ]] && item="$(dirs -p | fzf --color 'fg:27')"

        [[ "${item:0:1}" == "~" ]] && item="$HOME${item:1}"

        [[ -d "${item}" && ! -f "${item}" ]] && {
            cd "$item" || { echo "[ERROR] couldn't enter $item"; }
            continue
        }
        [[ -f "${item}" && ! -d "${item}" ]] && {
            openfile "${item}"
            continue
        }

        case "${item}" in
            'ADD ALIAS')
                printf "Enter alias name: "
                read aliasName
                printf "Enter command: "
                read cmd
                echo "alias $aliasName='$cmd'" >> "$HOME/Own_Repos/custom-console/util/chd.aliases"
                exit 0
            ;;

            'SHOW ALIASES')
                if [ -s "$HOME/Own_Repos/custom-console/util/chd.aliases" ]; then
                    cat "$HOME/Own_Repos/custom-console/util/chd.aliases"
                else
                    echo "[INFO] No aliases created."
                fi
                echo
                echo
                exit 0
            ;;

            *)
                echo "[ERROR] Unhandled item :- ${item}"
                exit 1
            ;;
        esac

    done
}


